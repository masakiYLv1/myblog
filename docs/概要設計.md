# 概要設計 (生成 AI と共に作成)

## **1. 概要**

本ドキュメントは、技術記事投稿プラットフォーム「myBlog」の概要設計を示す。

要件定義でまとめた内容を基に、**画面構成・データ構造・処理フロー・API 概要**を整理し、詳細設計・実装の指針とする。

---

## **2. システム構成（Architecture Overview）**

```text
┌──────────────────────────────────┐
│ フロントエンド（React + TypeScript + Vite）   │
│ ・UI：Chakra UI                               │
│ ・Routing：React Router Dom                   │
│ ・State：useState / React Query（任意）        │
└───────────────▲──────────────────┘
                │ Supabase JS Client
┌───────────────┴──────────────────┐
│ バックエンド（Supabase）                    │
│ ・Database（PostgreSQL）                    │
│ ・Auth（Email/Password）                    │
│ ・Storage（画像など、必要な場合）           │
│ ・RLS（アクセス制御）                       │
└──────────────────────────────────┘

デプロイ：Firebase Hosting
CI/CD：GitHub Actions

```

---

## **3. ページ一覧と構成（Screen Architecture）**

| 画面名             | URL                  | 目的                   | 表示内容                             | 使用 API              |
| ------------------ | -------------------- | ---------------------- | ------------------------------------ | --------------------- |
| トップ（記事一覧） | `/`                  | 公開記事を一覧表示     | タイトル / タグ / 著者 / 日付        | GET /articles         |
| 記事詳細           | `/articles/:id`      | 記事本文を表示         | Markdown → HTML / 著者 / タグ        | GET /articles/:id     |
| 新規投稿           | `/articles/new`      | 記事投稿               | 投稿フォーム（title, content, tags） | POST /articles        |
| 記事編集           | `/articles/:id/edit` | 記事の更新             | 既存記事の編集フォーム               | PATCH /articles/:id   |
| プロフィール       | `/users/:id`         | ユーザーの記事一覧表示 | ユーザー情報 / 投稿一覧              | GET /users/:id        |
| タグ一覧           | `/tags`              | タグ確認               | タグ一覧                             | GET /tags             |
| タグ別記事         | `/tags/:tag`         | タグで記事を絞り込み   | 記事一覧                             | GET /articles?tag=xxx |
| ログイン           | `/login`             | 認証                   | ログインフォーム                     | Supabase Auth         |

---

## **4. UI 構成（Component Design）**

## 4-1. 共通コンポーネント

- **Header**
  - ロゴ / 検索ボックス（Phase2） / ログイン / 新規投稿
- **ArticleCard**
  - タイトル / タグ / 著者 / 投稿日
- **TagBadge**
  - タグ表示
- **MarkdownViewer**
  - Markdown → HTML 変換表示
- **MarkdownEditor**
  - テキストエリア + プレビュー

---

## 4-2. 画面ごとの主要コンポーネント構成

### ● 記事一覧

```text
Header
ArticleList
 └ ArticleCard[]
TagList（任意）

```

### ● 記事詳細

```text
Header
ArticleHeader（タイトル / 著者 / タグ）
MarkdownViewer
EditButton（本人のみ）

```

### ● 記事投稿/編集

```text
Header
ArticleForm
 ├ InputTitle
 ├ MarkdownEditor
 ├ TagSelector
 └ PublishToggle
PreviewModal

```

---

## **5. データ構造（Entity Overview）**

※ 詳細は ER 図・DB 定義書で定義

## 5-1. users

| カラム名   | 型        | 説明                 |
| ---------- | --------- | -------------------- |
| id         | uuid      | Supabase Auth の uid |
| name       | text      | 表示名               |
| bio        | text      | 自己紹介             |
| created_at | timestamp | 登録日               |

---

## 5-2. articles

| カラム名   | 型        | 説明           |
| ---------- | --------- | -------------- |
| id         | uuid      | 記事 ID        |
| user_id    | uuid      | 著者           |
| title      | text      | タイトル       |
| content    | text      | Markdown 本文  |
| is_public  | boolean   | 公開 or 下書き |
| created_at | timestamp | 投稿日時       |
| updated_at | timestamp | 更新日時       |

---

## 5-3. tags

| カラム名 | 型   | 説明               |
| -------- | ---- | ------------------ |
| id       | uuid | タグ ID            |
| name     | text | タグ名（ユニーク） |

---

## 5-4. article_tag（多対多）

| カラム名   | 型   | 説明 |
| ---------- | ---- | ---- |
| article_id | uuid | 記事 |
| tag_id     | uuid | タグ |

---

## **6. 主要機能の処理フロー（High-level Flow）**

---

## 6-1. 新規記事投稿フロー

```text
ユーザー → 新規投稿画面
 → title/content/tags を入力
 → 「投稿」クリック
 → Supabase に INSERT
 → article_tag を登録
 → /articles/:id にリダイレクト

```

---

## 6-2. 記事編集フロー

```text
ユーザー → 記事編集画面
 → フォームを編集
 → UPDATE articles
 → article_tag の再登録
 → 記事詳細に遷移

```

---

## 6-3. 記事詳細表示フロー

```text
URLアクセス
 → Supabase から記事を取得
 → is_public = true or user_id = current_user の場合のみ表示
 → Markdown → HTML に変換
 → 表示

```

---

## **7. API 概要（Supabase CRUD の整理）**

※ 詳細は API 仕様書で作成

## articles

| 操作   | 内容                   |
| ------ | ---------------------- |
| SELECT | 公開記事一覧、詳細取得 |
| INSERT | 新規記事投稿           |
| UPDATE | 記事編集               |
| DELETE | 記事削除（任意）       |

## tags

| 操作   | 内容                 |
| ------ | -------------------- |
| SELECT | タグ一覧             |
| INSERT | タグが未登録なら作成 |

## users

| 操作   | 内容             |
| ------ | ---------------- |
| SELECT | プロフィール取得 |

---

## **8. 認証とアクセス制御（Auth & RLS）**

- **公開記事**：全ユーザー閲覧可
- **下書き記事**：投稿者本人のみ
- **編集・削除**：投稿者本人のみ
- **記事作成**：ログイン必須
- **タグ作成**：ログイン必須（または投稿時自動作成）

---

## **9. デプロイ構成**

```text
GitHub → GitHub Actions → Firebase Hosting（本番）

```

- main ブランチ push → 自動デプロイ
- Supabase はクラウド側でホスティングされているためセットアップ不要

---

## **10. ログ・監視（任意）**

---

## **11. 開発ルール（Coding Rules）**

- TypeScript strict モード
- atomic design（component / layout / page）
- ディレクトリ構成例：

```text
src/
 ├ components/
 ├ pages/
 ├ hooks/
 ├ types/
 ├ lib/
 │   └ supabaseClient.ts
 ├ utils/
 ├ router/
 └ App.tsx

```

---

## **12. 今後の拡張性の考慮**

- 記事検索（全文検索 / タグ検索）
- いいね機能
- コメント機能
- OGP 生成（記事シェア用）
- ダークテーマ対応
